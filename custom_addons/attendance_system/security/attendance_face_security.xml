<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ========== Groups ========== -->
    <record id="group_attendance_employee" model="res.groups">
        <field name="name">Attendance: Employee</field>
        <field name="category_id" ref="base.module_category_human_resources"/>
    </record>

    <record id="group_attendance_department_manager" model="res.groups">
        <field name="name">Attendance: Department Manager</field>
        <field name="category_id" ref="base.module_category_human_resources"/>
        <!-- Thường gán kèm group quản lý phòng ban của HR nếu bạn dùng sẵn -->
        <!-- <field name="implied_ids" eval="[(4, ref('hr.group_hr_manager'))]"/> -->
    </record>

    <record id="group_attendance_hr" model="res.groups">
        <field name="name">Attendance: HR</field>
        <field name="category_id" ref="base.module_category_human_resources"/>
        <!-- HR có thể implied từ HR Manager tùy chiến lược phân quyền -->
        <!-- <field name="implied_ids" eval="[(4, ref('hr.group_hr_user'))]"/> -->
    </record>

    <!-- ========== Record Rules ========== -->
    <!-- 1) Employee: chỉ xem/ghi (check-out) bản ghi của chính mình -->
    <record id="attendance_rule_employee_self" model="ir.rule">
        <field name="name">Attendance: Own Records</field>
        <field name="model_id" ref="hr_attendance.model_hr_attendance"/>
        <field name="domain_force">[('employee_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('attendance_system.group_attendance_employee'))]"/>
    </record>

    <!-- 2) Department Manager: thấy dữ liệu của phòng ban mình -->
    <record id="attendance_rule_department_manager" model="ir.rule">
        <field name="name">Attendance: Department Records</field>
        <field name="model_id" ref="hr_attendance.model_hr_attendance"/>
        <field name="domain_force">[('employee_id.department_id.manager_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('attendance_system.group_attendance_department_manager'))]"/>
    </record>

    <!-- 3) HR: full data (không tạo rule để không bị giới hạn) -->
    <!-- Không cần rule cho group_attendance_hr -->

    <!-- 4) Admin (base.group_system): full data + cấu hình (đã có sẵn từ Odoo) -->
    <!-- Không cần rule riêng vì Admin thường bypass, và đã có access ở CSV -->

</odoo>
